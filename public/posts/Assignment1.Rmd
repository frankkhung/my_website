---
title: "The True Reason of Why People Are Waiting For So Long For the Streetcar"
author: "Chien-Che Hung"
date: "2020-09-21"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r packages, echo=FALSE, message=FALSE}
library(readxl)
library(ggplot2) 
library(tidyverse)
library(forcats)
library(plyr)
library(kableExtra)
library(opendatatoronto)


ttc_agg <- list_package_resources("https://open.toronto.ca/dataset/ttc-streetcar-delay-data/")[7,] %>% get_resource()

jan <- as.data.frame(ttc_agg$`Jan 2019 `)
names <- names(jan)
fab <- as.data.frame(ttc_agg$`Feb 2019 `)
mar <- as.data.frame(ttc_agg$`Mar 2019 `)
april <- as.data.frame(ttc_agg$`Apr 2019`)[-6]
colnames(april) <- c(names)
may <- as.data.frame(ttc_agg$`May 2019 `)
june <- as.data.frame(ttc_agg$`June 2019 `)
colnames(june) <- c(names)
july <- as.data.frame(ttc_agg$`July 2019 `)
colnames(july) <- c(names)
aug <- as.data.frame(ttc_agg$`Aug, 2019 `)
colnames(aug) <- c(names)
sep <-as.data.frame(ttc_agg$`Sept 2019 `)
colnames(sep) <- c(names)
oct <-as.data.frame(ttc_agg$`Oct 2019 `)
colnames(oct) <- c(names)
nov <- as.data.frame(ttc_agg$` Nov 2019`) 
colnames(nov) <- c(names)
dec <- as.data.frame(ttc_agg$`Dec 2019`)
colnames(dec) <- c(names)

ttc_delay<- rbind(jan, fab, mar, april, may, june, july, aug, sep, oct, nov, dec)
                          
```

# Abstract
# Introduction
# Dataset

```{r, echo=FALSE, message=FALSE}
kable(head(ttc_delay, n= 5)) %>% kable_styling(position = "left") 
```

The above dataset is from the City of Toronto's Open Data Database. It delicately records the Toronto Transit Commission (TTC) streetcar system delays, which includes the data from 2014 to the present. Logically, if we wanted to analyze the most recent situation of the TTC delays, we would consider 2020's data. However, due to the current COVID-19 situation, it might produce some inaccurate results. Thus, this article would analyze the 2019 TTC streetcar delay data.

We can intuitively know what each variable represents from the headings (first five observations) of the data. Most importantly, [**Min of Delay**] shows the minutes of delay, and [**Incident**] reports the incidents that caused the delays. These two are the main variables that we will try to investigate closely.

```{r, echo=FALSE, message=FALSE, warning=FALSE, fig.align='center'}
ggplot(ttc_delay, aes(x = `Min Delay`)) +
  geom_density()
```


Before we dig deeper into the information in the dataset, let us briefly look at the structure of these two variables, [**Min of Delay**] and [**Incident**]. From the graph of the distribution of [**Min of Delay**], we can see that the delay time is primarily concentrated around 0 minutes, which implies that the delays could be in seconds since the data only contains the delayed rides. Assuming that the delay times are correct, we can see that the average delay time is around 14 minutes with a standard deviation of 34 minutes. For the [**Incident**], there are nine types of incidents in total: Mechanical, Investigation, Held by, General Delay, Late Leaving Garage, Emergency Services, Utilized off Route, Diversion, and Overhead-Pantograph.

```{r, echo=FALSE, message=FALSE}

delay_sum <- ttc_delay %>% 
  summarise(mean_delay = mean(ttc_delay$`Min Delay`, na.rm = TRUE), sd_delay = sd(ttc_delay$`Min Delay`, na.rm = TRUE))
kable(delay_sum, caption = "Short Statistical Summary of Min Delay") %>% kable_styling(position = "center")
```

After briefly summarized those two variables, we will closely investigate the relationship between the delayed minutes and the incidents that happened.




# Findings and Discussions
```{r, echo=FALSE, message=FALSE, fig.align='center'}
ggplot(ttc_delay, aes(x = forcats::fct_infreq(Incident))) +
  geom_bar(stat = "count") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 60, vjust = 0.6, hjust=0.5)) +
  labs(title = "Counts for each type of incidents") +
  xlab("Type of Incident")

delay_sum <- as.data.frame(aggregate(`Min Delay` ~ Incident, ttc_delay, mean))


delay_sum$Incident <- factor(delay_sum$Incident, levels = delay_sum$Incident[order(delay_sum$`Min Delay`, decreasing = TRUE)])
kable(delay_sum) %>% kable_styling(position = "center")

delay_sum %>%
  ggplot(aes(x = Incident, y = `Min Delay`)) +
  geom_bar(stat = "identity") + 
  labs(title = "Average Delay Time According to Incidents") +
  xlab("Type of Incidents") +
  ylab("Average Waiting Time (mins)") +
  theme_light() +
  theme(axis.text.x = element_text(angle = 60, vjust = 0.6, hjust=0.5))

```

# References